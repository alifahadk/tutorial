// Package main is auto-generated by gogen/namespacebuilder.go
//
// It provides funcs for instantiating the b_process namespace.
//
// To instantiate the b_process namespace, first call [New_b_process] and then either call 
// [Build] or [BuildWithParent].
// 
// See [golang.NamespaceBuilder] docs for more information about the behavior of [Build]
package main

import (
	"github.com/blueprint-uservices/blueprint/runtime/plugins/slogger"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/simplecache"
	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"github.com/blueprint-uservices/tutorial/examples/helloworld/workflow/serviceb"
	"blueprint/goproc/b_process/tutorial"
	"blueprint/goproc/b_process/http"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/golang"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/opentelemetry"
)

// Initializes the b_process namespace by defining all of the nodes that run
// within the namespace.
//
// [Build] or [BuildWithParent] must be called on the return value of this func
// to actually build and run the nodes in the namespace.
func New_b_process(name string) *golang.NamespaceBuilder {
	b := golang.NewNamespaceBuilder(name)
	set_b_process_Args(b)
	set_b_process_Instances(b)
	set_b_process_Definitions(b)
	return b
}

// b_process requires that its arguments are either:
//  - explicitly set with [golang.NamespaceBuilder.Set]
//  - passed on the command line (if built using [golang.NamespaceBuilder.Build])
//  - are defined in parent (if built using [golang.NamespaceBuilder.BuildWithParent])
//
// The following arguments will be eagerly checked and building the namespace
// will fail if they haven't been provided:
//   b_service.http.bind_addr
//
// The following arguments are optional and a failure will only occur if the client
// tries to build a node that needs the argument to be set
func set_b_process_Args(b *golang.NamespaceBuilder) {
	b.Required("b_service.http.bind_addr", "Argument generated by Blueprint IR: b_service.http.bind_addr = AddressConfig()")
}

// When the b_process namespace is built it will automatically instantiate
// the following nodes:
//   b_process.stdoutmetriccollector
//   b_process.logger
//   cache
//   b_service
//   b_service.hello.instrument.server
//   b_service.http_server
func set_b_process_Instances(b *golang.NamespaceBuilder) {
	b.Instantiate("b_process.stdoutmetriccollector")
	b.Instantiate("b_process.logger")
	b.Instantiate("cache")
	b.Instantiate("b_service")
	b.Instantiate("b_service.hello.instrument.server")
	b.Instantiate("b_service.http_server")
}

// The b_process namespace contains definitions for instantiating
// the following nodes:
//   b_process.logger
//   b_process.stdoutmetriccollector
//   b_service
//   b_service.hello.instrument.server
//   b_service.http_server
//   cache
func set_b_process_Definitions(b *golang.NamespaceBuilder) {
	b.Define("b_process.logger", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		return slogger.NewSLogger(n.Context())
	})
	
	b.Define("b_process.stdoutmetriccollector", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		return opentelemetry.NewStdoutMetricCollector(n.Context())
	})
	
	b.Define("b_service", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var cache backend.Cache
		if err := n.Get("cache", &cache); err != nil {
			return nil, err
		}
		
		return serviceb.NewServiceB(n.Context(), cache)
	})
	
	b.Define("b_service.hello.instrument.server", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var service serviceb.ServiceB
		if err := n.Get("b_service", &service); err != nil {
			return nil, err
		}
		
		return tutorial.New_ServiceB_TutorialInstrumentServerWrapper(n.Context(), service)
	})
	
	b.Define("b_service.http_server", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var service serviceb.ServiceB
		if err := n.Get("b_service.hello.instrument.server", &service); err != nil {
			return nil, err
		}
		
		var serverAddr string
		if err := n.Get("b_service.http.bind_addr", &serverAddr); err != nil {
			return nil, err
		}
		
		return http.New_ServiceB_HTTPServerHandler(n.Context(), service, serverAddr)
	})
	
	b.Define("cache", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		return simplecache.NewSimpleCache(n.Context())
	})
	
}
